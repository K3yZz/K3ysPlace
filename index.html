<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>K3yz Menu</title>
    <link rel="stylesheet" href="./mainpage/style.css" />
    <link rel="stylesheet" href="./globalassets/css/theme.css" />
  </head>

  <body>
    <span id="titleText">K3yz Place</span>
    <span id="versionText">V1.2.1 - Alpha</span>
    <button id="settingsButton" aria-label="Open settings">
      <!--change svg image-->
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        aria-hidden="true"
        style="display: block"
      >
        <circle
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="2"
          fill="rgba(255,255,255,0.05)"
        />
        <circle cx="12" cy="12" r="1.5" fill="currentColor" />
      </svg>
    </button>
    <div id="settingsPanel" hidden>
      <h2>Settings</h2>
      <select id="themeToggle">
        <option>default</option>
        <option>blue</option>
        <option>red</option>
      </select>
      <button id="bugReportButton">Send Feedback</button>
      <div id="bugReportFormContainer">
        <textarea
          id="bugDescription"
          placeholder="Describe the bug/Suggest an idea..."
        ></textarea>
        <input id="bugEmail" type="email" placeholder="Your email (optional)" />
        <button id="submitBug">Submit</button>
        <button id="cancelBug">Cancel</button>
        <span id="bugFeedback"></span>
      </div>
    </div>

    <div class="tab-buttons" role="tablist" aria-label="Games sections">
      <button
        class="tab-btn active"
        role="tab"
        aria-selected="true"
        data-tab="myGamesPanel"
      >
        My Games
      </button>
      <button
        class="tab-btn"
        role="tab"
        aria-selected="false"
        data-tab="portedGamesPanel"
      >
        Ported Games
      </button>
      <button
        class="tab-btn"
        role="tab"
        aria-selected="false"
        data-tab="toolsPanel"
      >
        Tools
      </button>
    </div>

    <div id="gamesContainer">
      <!-- Tab buttons -->

      <!-- Tab content panels -->
      <div
        id="myGamesPanel"
        class="tab-content active"
        role="tabpanel"
        aria-hidden="false"
      >
        <div id="myGames"></div>
      </div>

      <div
        id="portedGamesPanel"
        class="tab-content"
        role="tabpanel"
        aria-hidden="true"
      >
        <div id="portedGames"></div>
      </div>

      <div
        id="toolsPanel"
        class="tab-content"
        role="tabpanel"
        aria-hidden="true"
      >
        <div id="tools"></div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script src="./mainpage/main.js" type="module"></script>
    <script src="./globalassets/js/theme.js"></script>
    <script>
      if (localStorage.getItem("suppressAlerts") === "true") {
        return;
      }
      alert(
        "Theme applies wrong on the Casino & Chat. For now I suggest using the blue or default themes for best viewing experience. On another note, chat is now working."
      );
      alert(
        "Are you sure you read the previous alert? If so, click OK to dismiss this message."
      );
      alert("Are you sure though?");
      alert("Are you sureeeeeee though?");
      alert("Are you sure enough yet?");
      alert("One more time for good measure?");
      alert("Last time I swear.");
      (function generateAndVerifyKey() {
        const length = 8;
        const chars =
          "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        function genKey(len) {
          const arr = new Uint8Array(len);
          crypto.getRandomValues(arr);
          let s = "";
          for (let i = 0; i < len; i++) s += chars[arr[i] % chars.length];
          return s;
        }

        // Disable copy/paste/selection/context menu and common keyboard shortcuts, return a restore fn
        function disableCopyPaste() {
          const handlers = [];

          function add(type, handler, opts) {
        document.addEventListener(type, handler, opts);
        handlers.push({ type, handler, opts });
          }

          add("copy", (e) => e.preventDefault());
          add("cut", (e) => e.preventDefault());
          add("paste", (e) => e.preventDefault());
          add("contextmenu", (e) => e.preventDefault());
          add("selectstart", (e) => e.preventDefault());
          add("keydown", (e) => {
        const k = (e.key || "").toLowerCase();
        // block Ctrl/Cmd + C/V/X/A and Shift+Insert
        if ((e.ctrlKey || e.metaKey) && ["c", "v", "x", "a"].includes(k)) {
          e.preventDefault();
        }
        if (e.shiftKey && k === "insert") e.preventDefault();
          });

          // also disable CSS selection
          const prevUserSelect = document.documentElement.style.userSelect;
          document.documentElement.style.userSelect = "none";
          handlers.push({
        restore: () => {
          document.documentElement.style.userSelect = prevUserSelect;
        },
          });

          return function restore() {
        for (const h of handlers) {
          if (h.restore) {
            try {
          h.restore();
            } catch (e) {}
          } else {
            document.removeEventListener(h.type, h.handler, h.opts);
          }
        }
          };
        }

        const restoreCopyPaste = disableCopyPaste();

        const key = genKey(length);
        let entry;
        do {
          entry = prompt(
        "Please type the following 8-character key to continue:\n\n" + key,
        ""
          );
          if (entry === null || entry.trim() === "") {
        alert("A response is required to continue.");
        entry = null; // force loop to continue
        continue;
          }
          if (entry.trim() !== key) {
        alert("Incorrect key. Please try again.");
        entry = null;
          }
        } while (entry === null);

        restoreCopyPaste();
        alert("Access granted.");
      })();
      if (confirm("Would you like to disable these messages in the future?")) {
        if (confirm("Are you absolutely sure?")) {
        localStorage.setItem("suppressAlerts", "true");
      }
    }
    </script>
  </body>
</html>
